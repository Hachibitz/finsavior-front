<div class="overlay" *ngIf="loading">
  <div class="custom-loader"></div>
</div>
<app-header-bar></app-header-bar>
<div id="mainBody" class="fadeInUp" [class]="darkMode ? 'dark-mode' : 'light-mode'">
  <div class="grid">
    <div class="col-8">
      <div class="box-input">
        <div class="new-register">
          <div class="left-column">
            <mat-form-field>
              <mat-label>Mês e ano</mat-label>
              <input matInput [matDatepicker]="dp" [(ngModel)]="billDate">
              <mat-datepicker-toggle matIconSuffix [for]="dp"></mat-datepicker-toggle>
              <mat-datepicker #dp
                              startView="multi-year"
                              (monthSelected)="onSelectDate($event, dp)"
                              panelClass="example-month-picker">
              </mat-datepicker>
            </mat-form-field>
          </div>
          <form [formGroup]="mainTableForm" class="right-column">
            <label>Selecione o tipo: </label>
            <select class="custom-dropdown" style="margin-left: 10px;" formControlName="selectedType" (ngModelChange)="selectRegisterType()">
              <option *ngFor="let billType of billTypes" [value]="billType.value">{{ billType.label }}</option>
            </select>
            <input class="input-box" type="text" placeholder="Nome da conta" formControlName="billName">
            <input class="input-box" type="number" min="1" step="any" placeholder="Valor - Ex.: 35.50" formControlName="billValue">
            <input class="input-box" type="text" placeholder="Descrição" formControlName="billDescription">
            <button id="nonRecurrent" class="btn-register" style="margin-left: 10px;" (click)="addRegisterMain($event)">Cadastrar</button>
            <button id="recurrent" class="btn-register" style="margin-left: 10px;" (click)="addRecurrentRegister($event)">Cadastrar recorrente</button>
          </form>
        </div>
      </div>
    </div>
    <div class="col-4">
      <div class="box-input">
        <form [formGroup]="cardTableForm" class="new-register">
          <input class="input-box-card" type="text" placeholder="Conta" formControlName="cardBillName">
          <input class="input-box-card" type="number" min="1" step="any" placeholder="Valor" formControlName="cardBillValue">
          <input class="input-box-card" type="text" placeholder="Descrição" formControlName="cardBillDescription">
          <button class="btn-register small-btn" (click)="addRegisterCard()">Adicionar débito</button>
        </form>
      </div>
    </div>
  </div>
  <div class="grid">
    <div class="left-table">
      <div class="box-side">
        <div class="main">
          <div>
            <a>Caixa</a><label style="color: grey;">  (Salário+Ativos)</label><br>
            <label style="color: grey;">{{income}},00R$</label>
          </div><br>
          <a>Guia de contas</a>
          <ul>
            <li>
              <span class="title">Ativo</span><br><br>
              <span class="description">Direito ou valor que ficará disponível para ser encorporado à liquidez no
                futuro,
                exemplo: vale-alimentação, pagamento de empréstimo a receber, restituição de imposto, etc...</span>
            </li>
            <li>
              <span class="title">Passivo</span><br><br>
              <span class="description">Obrigação ou valor a diminuir da liquidez, exemplo: aluguel, parcela de carro,
                iptu, etc...</span>
            </li>
            <li>
              <span class="title">Caixa</span><br><br>
              <span class="description">Representa a injeção de valor valor imediato e disponível na liquidez, por
                exemplo: saldo de conta em banco.</span>
            </li>
            <li>
              <span class="title">Liquidez</span><br><br>
              <span class="description">Representa o seu estado financeiro atual: Liquidez=(Ativo+Caixa)-Passivo.
              </span>
            </li>
          </ul>
        </div>
      </div>
    </div>
    <div class="main-table">
      <mat-tab-group>
        <mat-tab label="Tabela Principal">
          <div class="main-table">
            <div class="main">
              <div class="table-title">
                <div>
                  <a>Tabela principal</a>
                </div>
                <div>
                  <a>Total de débitos: </a><label style="color: grey;">{{totalDebit}}R$</label>
                </div>
                <div>
                  <a>Total faltante: </a><label style="color: grey;">{{totalLeft}}R$</label>
                </div>
              </div>
              <table id="registerTable" style="margin-top: 10px;">
                <thead>
                  <tr>
                    <th>Nome</th>
                    <th>Valor</th>
                    <th>Tipo</th>
                    <th>Descrição</th>
                    <th>Data</th>
                    <th>Ações</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of rows" [ngClass]="{'paid-row': item.Pago}">
                    <td>{{ item.Nome }}</td>
                    <td>{{ item.Valor }}</td>
                    <td>{{ item.Tipo }}</td>
                    <td>{{ item.Descricao }}</td>
                    <td>{{ item.Data }}</td>
                    <td class="action-buttons">
                      <button mat-icon-button (click)="deleteItemFromMainTable(item)">
                        <mat-icon aria-label="Excluir">delete</mat-icon>
                      </button>
                      <button mat-icon-button (click)="openMainTableEditDialog(item)">
                        <mat-icon aria-label="Editar">edit</mat-icon>
                      </button>
                      <mat-checkbox [(ngModel)]="item.Pago" color="secondary" matTooltip="Marcar como Pago"
                        (ngModelChange)="markAsPaid(item)"></mat-checkbox>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </mat-tab>
        <mat-tab label="Tabela de Caixa + Ativos">
          <div class="income-table">
            <div class="main">
              <div class="table-title">
                <div>
                  <a>Tabela de caixa/ativos</a>
                </div>
                <div>
                  <a>Total de débitos: </a><label style="color: grey;">{{totalDebit}},00R$</label>
                </div>
                <div>
                  <a>Total faltante: </a><label style="color: grey;">{{totalLeft}},00R$</label>
                </div>
              </div>
              <table id="registerTable" style="margin-top: 10px;">
                <thead>
                  <tr>
                    <th>Nome</th>
                    <th>Valor</th>
                    <th>Tipo</th>
                    <th>Descrição</th>
                    <th>Data</th>
                    <th>Ações</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of incomeRows" [ngClass]="{'paid-row': item.Pago}">
                    <td>{{ item.Nome }}</td>
                    <td>{{ item.Valor }}</td>
                    <td>{{ item.Tipo }}</td>
                    <td>{{ item.Descricao }}</td>
                    <td>{{ item.Data }}</td>
                    <td class="action-buttons">
                      <button mat-icon-button (click)="deleteItemFromMainTable(item)">
                        <mat-icon aria-label="Excluir">delete</mat-icon>
                      </button>
                      <button mat-icon-button (click)="openMainTableEditDialog(item)">
                        <mat-icon aria-label="Editar">edit</mat-icon>
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </mat-tab>
      </mat-tab-group>  
    </div>  
    <div class="right-table">
      <div class="box-side">
        <div class="main">
          <a>
            Tabela de detalhamento de cartão de crédito
          </a>
          <table id="cardTable" style="margin-top: 10px;">
            <thead>
              <tr>
                <th>Nome</th>
                <th>Valor</th>
                <th>Descrição</th>
                <th>Data</th>
                <th>Ações</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let item of cardRows">
                <td>{{ item.Nome }}</td>
                <td>{{ item.Valor }}</td>
                <td>{{ item.Descricao }}</td>
                <td>{{ item.Data }}</td>
                <td class="action-buttons">
                  <button mat-icon-button (click)="deleteItemFromCardTable(item)">
                    <mat-icon aria-label="Excluir">delete</mat-icon>
                  </button>
                  <button mat-icon-button (click)="openCardTableEditDialog(item)">
                    <mat-icon aria-label="Editar">edit</mat-icon>
                  </button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
  <div class="bottom-page grid">
    <div class="bottom-box-left">
      <div class="main">
        <div class="bottom-boxes">
          <div class="status-box">
            <h3>Status atual</h3>
            <p>R$ {{liquidStatus}}</p>
          </div>
          <div class="status-box">
            <p>Dicas e insights gerados por IA (Coming soon)</p>
          </div>
        </div>
      </div>
    </div>
    <div class="bottom-box-right">
      <div class="main">
        <div class="bottom-boxes">
          <div class="status-box">
            <h3>Liquidez</h3>
            <p>R$ {{liquidAndRightsStatus}}</p>
          </div>
          <div class="status-box">
            <p>Dicas e insights gerados por IA (Coming soon)</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<!--<div class="dark-mode-toggle">
  <label class="switch">
    <input type="checkbox" [(ngModel)]="darkMode" (ngModelChange)="toggleDarkMode()">
    <span class="slider round"></span>
  </label>
</div>-->
<!--<div class="dark-mode-toggle" (click)="toggleDarkMode()">
  <div class="slider round" [class.checked]="darkMode"></div>
</div>-->